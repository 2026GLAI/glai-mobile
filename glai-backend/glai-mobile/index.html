<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GLAi</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #ffffff;
      color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 420px;
      padding: 20px;
      box-sizing: border-box;
    }

    textarea {
      width: 100%;
      min-height: 100px;
      padding: 12px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
    }

    .response {
      margin-top: 16px;
      font-size: 16px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="app">
    <textarea id="input"></textarea>
    <button id="send"></button>
    <div id="response" class="response"></div>
  </div>

  <script>
    // === ENV ===
    const ENV = "dev"; // dev | prod

    const BACKEND_URLS = {
      dev: "http://localhost:3000/interact",
      prod: "https://YOUR-PRODUCTION-BACKEND/interact"
    };

    const BACKEND_URL = BACKEND_URLS[ENV];

    // === LANGUAGE (AUTO, GREEK DEFAULT) ===
    const userLang = (navigator.language || "el").toLowerCase();
    const isGreek = userLang.startsWith("el");

    const TEXT = {
      el: {
        placeholder: "Γράψε την ερώτησή σου εδώ…",
        send: "Αποστολή",
        error: "Κάτι πήγε στραβά."
      },
      en: {
        placeholder: "Write your question here…",
        send: "Send",
        error: "Something went wrong."
      }
    };

    const UI = isGreek ? TEXT.el : TEXT.en;

    // === SESSION ID (STABLE PER DEVICE) ===
    const SESSION_KEY = "glai_session_id";
    let sessionId = localStorage.getItem(SESSION_KEY);
    if (!sessionId) {
      sessionId = "web-" + Math.random().toString(36).slice(2);
      localStorage.setItem(SESSION_KEY, sessionId);
    }

    // === UI BINDINGS ===
    const sendButton = document.getElementById("send");
    const inputField = document.getElementById("input");
    const responseBox = document.getElementById("response");

    inputField.placeholder = UI.placeholder;
    sendButton.textContent = UI.send;

    sendButton.addEventListener("click", async () => {
      const text = inputField.value.trim();
      if (!text) return;

      responseBox.textContent = "…";

      try {
        const res = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            sessionId,
            input: text
          })
        });

        const data = await res.json();
        responseBox.textContent = data.response;
      } catch {
        responseBox.textContent = UI.error;
      }
    });

    // === SERVICE WORKER ===
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</body>
</html>
